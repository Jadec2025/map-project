<!DOCTYPE html>
<html>
<head>
  <title>Zip Code Zone Search</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 600px; }

    .legend {
      background: white;
      padding: 10px;
      line-height: 18px;
      color: #333;
      font-size: 14px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
    }
    .legend i {
      vertical-align: middle;
      margin-right: 6px;
      width: 18px;
      height: 18px;
      display: inline-block;
    }
  </style>
</head>
<body>

  <input type="text" id="zipInput" placeholder="Enter ZIP code" />
  <button onclick="searchZip()">Search</button>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const zipData = {
           "77001": "B", "77002": "B", "77003": "B", "77004": "B", "77005": "B",
      "77006": "B", "77007": "B", "77008": "B", "77009": "B", "77010": "B",
      "77011": "B", "77012": "B", "77013": "B", "77014": "C", "77015": "B",
      "77016": "B", "77017": "B", "77018": "B", "77019": "B", "77020": "B",
      "77021": "B", "77022": "B", "77023": "B", "77024": "C", "77025": "B",
      "77026": "B", "77027": "C", "77028": "B", "77029": "B", "77030": "B",
      "77031": "C", "77032": "C", "77033": "B", "77034": "A", "77035": "C",
      "77036": "C", "77037": "C", "77038": "C", "77039": "C", "77040": "C",
      "77041": "C", "77042": "C", "77043": "C", "77044": "B", "77045": "B",
      "77046": "B", "77047": "B", "77048": "B", "77049": "B", "77050": "B",
      "77051": "B", "77052": "B", "77053": "C", "77054": "B", "77055": "C",
      "77056": "C", "77057": "C", "77058": "A", "77059": "A", "77060": "C",
      "77061": "B", "77062": "A", "77063": "C", "77064": "D", "77065": "D",
      "77066": "C", "77067": "C", "77068": "C", "77069": "D", "77070": "D",
      "77071": "C", "77072": "C", "77073": "C", "77074": "C", "77075": "B",
      "77076": "C", "77077": "C", "77078": "B", "77079": "C", "77080": "C",
      "77081": "C", "77082": "D", "77083": "D", "77084": "D", "77085": "C",
      "77086": "C", "77087": "A", "77088": "C", "77089": "B", "77090": "C",
      "77091": "C", "77092": "C", "77093": "B", "77094": "D", "77095": "D",
      "77096": "B", "77097": "D", "77098": "B", "77099": "B", "77301": "D",
      "77302": "D", "77303": "D", "77304": "D", "77305": "D", "77306": "D",
      "77325": "C", "77336": "C", "77337": "D", "77338": "B", "77339": "B",
      "77345": "B", "77346": "B", "77355": "D", "77354": "D", "77356": "E",
      "77357": "D", "77362": "D", "77365": "D", "77372": "D", "77373": "C",
      "77375": "D", "77377": "D", "77378": "E", "77379": "D", "77380": "D",
      "77381": "D", "77382": "D", "77383": "D", "77384": "D", "77385": "D",
      "77386": "D", "77387": "D", "77388": "D", "77389": "D", "77391": "D",
      "77396": "C", "77406": "D", "77410": "D", "77411": "C", "77423": "E",
      "77429": "D", "77433": "D", "77437": "F", "77449": "D", "77450": "D",
      "77459": "C", "77469": "D", "77471": "C", "77476": "D", "77477": "C",
      "77478": "C", "77479": "C", "77484": "E", "77487": "C", "77489": "C",
      "77491": "C", "77492": "D", "77493": "D", "77494": "D", "77501": "A",
      "77502": "A", "77503": "A", "77504": "A", "77505": "A", "77506": "A",
      "77507": "A", "77508": "A", "77510": "A", "77511": "A", "77512": "A",
      "77517": "A", "77520": "A", "77521": "A", "77522": "A", "77530": "A",
      "77536": "A", "77539": "A", "77545": "A", "77546": "A", "77549": "B",
      "77571": "A", "77572": "A", "77573": "B", "77574": "A", "77578": "C",
      "77581": "B", "77583": "D", "77584": "F", "77585": "F", "77586": "A",
      "77587": "B", "77588": "C", "77597": "C", "77598": "B"
    };


    const zoneColors = {
      "A": "#a8e6cf",
      "B": "#dcedc1",
      "C": "#ffd3b6",
      "D": "#ffaaa5",
      "E": "#ff8b94",
      "F": "#d291bc"
    };

    const zonePrices = {
      "A": "$200",
      "B": "$225",
      "C": "$280",
      "D": "$315",
      "E": "$450",
      "F": "$550"
    };

    let map = L.map('map').setView([29.76, -95.37], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    let geojsonLayer;
    let geojsonData;

    fetch('map.geojson')
      .then(res => res.json())
      .then(data => {
        geojsonData = data;
      })
      .catch(e => {
        alert("Failed to load GeoJSON data. Check your file path.");
        console.error(e);
      });

    function searchZip() {
      const zip = document.getElementById('zipInput').value.trim();

      if (!zipData[zip]) {
        alert("ZIP code not found in zone data.");
        return;
      }

      if (!geojsonData) {
        alert("GeoJSON data not loaded yet.");
        return;
      }

      if (geojsonLayer) {
        map.removeLayer(geojsonLayer);
      }

      geojsonLayer = L.geoJSON(geojsonData, {
        filter: function(feature) {
          return feature.properties.zip === zip;
        },
        style: function(feature) {
          const zone = zipData[feature.properties.zip];
          const color = zoneColors[zone] || "#cccccc";
          return {
            color: color,
            fillColor: color,
            weight: 2,
            fillOpacity: 0.5
          };
        },
        onEachFeature: function(feature, layer) {
          const zone = zipData[feature.properties.zip];
          const price = zonePrices[zone] || "N/A";
          layer.bindPopup(`<b>ZIP: ${feature.properties.zip}</b><br>Zone: ${zone}<br>Price: ${price}`);
        }
      }).addTo(map);

      const bounds = geojsonLayer.getBounds();
      if (bounds.isValid()) {
        map.fitBounds(bounds);
      } else {
        alert("No geometry found for this ZIP code.");
      }
    }

    // Add zone legend to map
    const legend = L.control({ position: 'bottomright' });

    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'info legend');
      const zones = Object.keys(zoneColors);

      div.innerHTML += '<strong>Zone Legend</strong><br>';
      zones.forEach(zone => {
        div.innerHTML += `
          <i style="background:${zoneColors[zone]}"></i>
          Zone ${zone} - ${zonePrices[zone]}<br>
        `;
      });

      return div;
    };

    legend.addTo(map);
  </script>

</body>
</html>
